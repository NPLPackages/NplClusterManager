<?npl
--[[
Title: run any NPL code from web page
Author: LiXizhi
Date: 2015/6/23
Desc: 
- ajax/console?action=runcode&text=poststring&src=filename

Print all url params
- ajax/?action=getparams 

-- print request
- ajax/console?action=printrequest
]]

local NodeList = {"127.0.0.1", "127.0.0.2", "127.0.0.3"};
local newIP = request:get("text");
local function getNewIP()
	return newIP or "";
end

local function AddNodeWithResult(output)
	if(not newIP or newIP == "") then 
		return;
	end
	table.insert(NodeList, newIP);
	output = "true";
end

if(is_ajax()) then
	add_action('wp_ajax_cluster_get_nodelist', function()
		wp_send_json({nodelist = NodeList}, true);
	end)

	add_action('wp_ajax_cluster_addnode', function()
		
		local output = {};
		AddNodeWithResult(output);
		wp_send_json(output);
		
    end)

	return;
end

?>




<?npl
wp_enqueue_script("ace", "/wp-includes/js/ace/ace.js"); 
wp_enqueue_script("angular", "/wp-includes/js/angular/angular.min.js");
wp_enqueue_script("ui.bootstrap",				"/wp-includes/js/angular/ui-bootstrap-tpls-1.3.3.min.js");
wp_enqueue_script("ngStorage", "/wp-includes/js/angular/ngStorage.js");
wp_enqueue_script("ngSanitize", "/wp-includes/js/angular/angular-sanitize.min.js");

wp_enqueue_script("ClusterManager_App",			"/wp-content/pages/cluster/app.js");
wp_enqueue_script("ClusterManagerController",		"/wp-content/pages/cluster/controllers/ClusterManagerController.js");

LOG.std(nil, "info", "cluster main", "cluster page init");
?>



<div class="title">NPL Cluster Manager</div>
<div ng-app="ClusterManager_App">
	<cluster-main></cluster-main>
</div>