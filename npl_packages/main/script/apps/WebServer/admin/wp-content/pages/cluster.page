<?npl
--[[
Title: run any NPL code from web page
Author: LiXizhi
Date: 2015/6/23
Desc: 
- ajax/console?action=runcode&text=poststring&src=filename

Print all url params
- ajax/?action=getparams 

-- print request
- ajax/console?action=printrequest
]]

NPL.load("(gl)Mod/NplClusterManager/LocalResourceInfo.lua");
local LocalResourceInfo = commonlib.gettable("Mod.NplClusterManager.LocalResourceInfo");

local NodeList = {"127.0.0.1", "127.0.0.2"};
local newIP = request:get("text");
local function getNewIP()
	return newIP or "";
end

if(is_ajax()) then
	add_action('wp_ajax_cluster_get_nodelist', function()
		LOG.std(nil, "info", "clusrter", "cluster get nodelist");
		wp_send_json({nodelist = NodeList}, true);
	end)

	add_action('wp_ajax_cluster_addnode', function()
		LOG.std(nil, "info", "clusrter", "cluster add node");
		--AddNodeWithResult(output);
		table.insert(NodeList, newIP);
		if(newIP == "123") then 
			wp_send_json({result = "节点添加成功"}, true);
		else
			wp_send_json({result = "节点添加失败，请确认后重试"}, true);
		end
		LOG.std(nil, "info", "clusrter",  NodeList);
		--response:status(200):send({"please check log.txt"}, true);
		
    end)

	add_action('wp_ajax_cluster_getres', function()
		
	end)

	return;
end

?>




<?npl
wp_enqueue_script("ace", "/wp-includes/js/ace/ace.js"); 
wp_enqueue_script("angular", "/wp-includes/js/angular/angular.min.js");
wp_enqueue_script("ui.bootstrap",				"/wp-includes/js/angular/ui-bootstrap-tpls-1.3.3.min.js");
wp_enqueue_script("ngStorage", "/wp-includes/js/angular/ngStorage.js");
wp_enqueue_script("ngSanitize", "/wp-includes/js/angular/angular-sanitize.min.js");

wp_enqueue_script("ClusterManager_App",			"/wp-content/pages/cluster/app.js");
wp_enqueue_script("ClusterManagerController",		"/wp-content/pages/cluster/controllers/ClusterManagerController.js");

LOG.std(nil, "info", "cluster main", "cluster page init");
?>



<div class="title">NPL Cluster Manager</div>
<div ng-app="ClusterManager_App">
	<cluster-main></cluster-main>
</div>
